(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/customMode/index"],{1677:function(t,e,a){"use strict";a.r(e);var n=a("70d2"),i=a.n(n);for(var o in n)"default"!==o&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},"398b":function(t,e,a){},"44d7":function(t,e,a){"use strict";a.r(e);var n=a("700a"),i=a("1677");for(var o in i)"default"!==o&&function(t){a.d(e,t,(function(){return i[t]}))}(o);a("48ab");var s,r=a("f0c5"),d=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=d.exports},"48ab":function(t,e,a){"use strict";var n=a("398b"),i=a.n(n);i.a},"700a":function(t,e,a){"use strict";var n;a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return n}));var i=function(){var t=this,e=t.$createElement,a=(t._self._c,t.__get_style([t.shadeStyleObject]));t.$mp.data=Object.assign({},{$root:{s0:a}})},o=[]},"70d2":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(a("24ea")),i=a("2f62"),o=s(a("a259"));function s(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach((function(e){c(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function c(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var u=function(){a.e("pages/components/crop/cropper").then(function(){return resolve(a("8890"))}.bind(null,a)).catch(a.oe)},l=function(){a.e("pages/components/module/wrap").then(function(){return resolve(a("b718"))}.bind(null,a)).catch(a.oe)},h=function(){a.e("pages/components/module/image").then(function(){return resolve(a("149e"))}.bind(null,a)).catch(a.oe)},m=function(){a.e("pages/components/module/text").then(function(){return resolve(a("c858"))}.bind(null,a)).catch(a.oe)},f={components:{gmyImgCropper:u,wrapDiv:l,imageDiv:h,textDiv:m},data:function(){return{detailData:{},thumb_path:"",Id:0,name:"",seconds:20,contentId:0,removeStatu:!1,imgSrc:"123",detaArr:{},disAbledBtn:!0,tpl:{dynamic:{words:{},images:{}}},fontObj:{content:""},saveStatus:!0,indexData:"background",base_url:"",imageW:0,imageH:0,width:100,height:100,zoom:1,imgCropperShow:2,rates:1,editMode:!1,textValue:"",userFeedbackHidden:!0,feedbackContent:"",shadeStyleObject:{top:0,bottom:0,transform:""}}},computed:d({},(0,i.mapState)({modeTpl:function(t){return t.tpl}})),onLoad:function(t){var e=this;this.$req({method:"GET",url:"/bank/app/h5/templates/"+t.id,data:{}}).then((function(a){0===a.data.message.direction?e.rates=Math.floor(wx.getSystemInfoSync().windowWidth/a.data.message.width*1e3)/1e3:e.rates=Math.floor(wx.getSystemInfoSync().windowWidth/a.data.message.width*700)/1e3,e.height=a.data.message.height,e.width=a.data.message.width,e.base_url=a.data.message.base_url,e.detaArr=JSON.parse(a.data.message.dynamic),e.thumb_path=a.data.message.thumb_path,e.Id=a.data.message.id,e.removeStatu=!t.type,t.type?(e.contentId=t.type,e.seconds=e.modeTpl.seconds,e.name=e.modeTpl.name,e.modeTpl.tpl.dynamic&&(e.modeTpl.tpl.dynamic.images.constructor!==Array&&(e.tpl.dynamic.images=e.modeTpl.tpl.dynamic.images,e.updateList(e.modeTpl.tpl.dynamic.images,e.detaArr,1)),e.modeTpl.tpl.dynamic.words.constructor!==Array&&(e.tpl.dynamic.words=e.modeTpl.tpl.dynamic.words,e.updateList(e.modeTpl.tpl.dynamic.words,e.detaArr,0)))):e.newBuilt().then((function(t){e.contentId=t.message.id,e.name=t.message.name}))})).catch((function(t){console.log(t)}))},onUnload:function(){this.removeStatu&&o.default.deleteContentLists(this.contentId)},methods:d(d(d({},(0,i.mapActions)(["getContentLists"])),(0,i.mapMutations)(["ADD_CONTENT_LIST","REMOVE_CONTENT_LIST"])),{},{chooseImg:function(t,e){this.imageW=e.width*this.rates,this.imageH=e.height*this.rates,this.indexData=t,this.imgCropperShow=0,this.$refs.gmyImgCropper.getImage()},chooseText:function(t,e){this.indexData=t,this.editMode=!0,this.saveStatus=!this.saveStatus,this.textValue=e.text},closeTextModeL:function(){this.editMode=!1,this.setData(this.textValue,this.detaArr,0),this.saveStatus=!this.saveStatus},saveText:function(){this.closeTextModeL()},getImg:function(e){var a=this,i=t.getStorageSync("Token");wx.uploadFile({url:n.default+"/bank/app/h5/contents/uploading",filePath:e,name:"image",header:{Authorization:"Bearer"+i,"content-type":"multipart/form-data"},formData:{content_id:this.contentId,image:e},success:function(t){var e=JSON.parse(t.data).message.image_url;a.setData(e,a.detaArr,1),a.imgCropperShow=!1}})},setData:function(t,e,a){var n=this;Object.keys(e).forEach((function(i){i==n.indexData&&1===a?(e[n.indexData].backgroundImage=t,n.tpl.dynamic.images[n.indexData]=t):i==n.indexData&&0===a?(n.fontObj.content=t,e[n.indexData].text=t,n.tpl.dynamic.words[n.indexData]=JSON.stringify(n.fontObj)):e[i].childData&&n.setData(t,e[i].childData,a)}))},updateList:function(t,e,a){var n=this;Object.keys(t).forEach((function(i){Object.keys(e).forEach((function(o){if(i==o&&1===a)e[o].backgroundImage=t[i];else if(i==o&&0===a){var s=JSON.parse(t[i]);e[o].text=s.content}else e[o].childData&&n.updateList(t,e[o].childData,a)}))}))},save:function(){this.disAbledBtn=!1,this.userFeedbackHidden=!1},closeFeedback:function(){this.disAbledBtn=!0,this.userFeedbackHidden=!0},submitFeedback:function(){var e=this;this.seconds>65535?t.showToast({title:"最大时长65535",image:"/static/Fail.png",duration:1e3}):""==this.seconds?t.showToast({title:"时长不能为空",image:"/static/Fail.png",duration:1e3}):""===this.name?t.showToast({title:"名称不能为空",image:"/static/Fail.png",duration:1e3}):(this.userFeedbackHidden=!0,this.disAbledBtn=!1,t.showLoading({title:"保存中..."}),this.$req({method:"PUT",url:"/bank/app/h5/contents/"+this.contentId,data:{name:this.name,seconds:this.seconds,tpl:this.tpl}}).then((function(a){a.data.success?(t.hideLoading(),e.removeStatu?(e.ADD_CONTENT_LIST(a.data.message),e.removeStatu=!1):(e.REMOVE_CONTENT_LIST(),e.getContentLists({page:0,pagesize:10})),t.showToast({title:"保存成功",duration:1e3}),t.switchTab({url:"/pages/modeList/index"})):t.showToast({title:a.data.message,duration:1500}),e.disAbledBtn=!0})))},newBuilt:function(){var e=this,a=new Promise((function(a,n){o.default.bliudContentLists(e.Id,e.thumb_path).then((function(e){e.data.success?a(e.data):t.showToast({title:"保存失败",image:"/static/Fail.png",duration:2e3})})).catch((function(t){n(t),console.log(t)}))}));return a},show:function(t){this[t].showCode()}})};e.default=f}).call(this,a("543d")["default"])},f311:function(t,e,a){"use strict";(function(t){a("8a46");n(a("66fd"));var e=n(a("44d7"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])}},[["f311","common/runtime","common/vendor"]]]);
(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/playList/index"],{"9c72":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(n("a259")),a=n("2f62");function s(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(){n.e("pages/components/uni-grid/uni-grid").then(function(){return resolve(n("16d4"))}.bind(null,n)).catch(n.oe)},d=function(){n.e("pages/components/uni-grid-item/uni-grid-item").then(function(){return resolve(n("39ec"))}.bind(null,n)).catch(n.oe)},h=function(){n.e("pages/components/drawer/index").then(function(){return resolve(n("958e"))}.bind(null,n)).catch(n.oe)},l=function(){n.e("pages/components/group/tags").then(function(){return resolve(n("78d8"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("pages/components/group/tree").then(function(){return resolve(n("88d2"))}.bind(null,n)).catch(n.oe)},g=function(){n.e("pages/components/tki-tree/tki-tree").then(function(){return resolve(n("2dc7"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("pages/components/actionSheet/index").then(function(){return resolve(n("59b8"))}.bind(null,n)).catch(n.oe)},m={components:{uniGrid:u,uniGridItem:d,drawer:h,tags:l,tree:f,actionSheet:p,tkiTree:g},data:function(){var t,e=this.getDate({format:!0});return t={scrollTop:50,isLoadMore:!1,loadTitle:"没有数据了",title:"播出单",array:[],tagsArr:[],treeArr:[],tags:[],tree:[],iconType:["success"],playStatus:0,swiperheight:0,pagesize:12,groupId:0,id:0,index:0,chooseAfterValue:[],formData:{name:"",schedule:{date:{start:"",end:""},time:{start:"",end:""}},etype:0,type:0},defaultActive:[],direction:0,timeStart:"00:00",timeEnd:"09:00",timeOther:"请选择时间",endDate:"请选择日期",selectData:{},dateStart:e,dateEnd:e},c(t,"isLoadMore",!1),c(t,"isOpened",!1),c(t,"menuArr",[{title:"发布",type:0},{title:"停止",type:1},{title:"编辑",type:3},{title:"删除",type:2}]),t},onLoad:function(){var e=this;t.showLoading({title:"加载中"}),this.getDataLists(),0===this.dataList.length&&this.getContentList(),i.default.getTags().then((function(t){e.tagsArr=t.data.message})),i.default.getTrees().then((function(t){e.treeArr=[t.data.message]}))},onPullDownRefresh:function(){this.array=[],this.getDataLists()},computed:o(o({},(0,a.mapState)({dataList:function(t){return t.contentLists},page:function(t){return t.page}})),{},{fiterFiles:function(){var t=this,e=[];return e=this.dataList.filter((function(e){return e.direction===t.direction})),e},saveNext:function(){var t=!0;return 0===this.chooseAfterValue.length&&(t=!1),0===this.tree.length&&0===this.tags.length&&(t=!1),""===this.formData.name&&(t=!1),t}}),methods:o(o(o({},(0,a.mapMutations)(["SET_CONTENT_LIST","PUT_CONTENT_PAGE"])),(0,a.mapActions)(["getContentLists"])),{},{scrollFn:function(t){this.isLoadMore&&1!==this.page||(this.isLoadMore=!0,this.PUT_CONTENT_PAGE(2),this.getContentList())},choosely:function(t,e){-1!=this.chooseAfterValue.indexOf(e)?this.chooseAfterValue.splice(this.chooseAfterValue.indexOf(e),1):this.chooseAfterValue.push(e)},seqencingData:function(t){var e=new Object;Object.keys(t).forEach((function(n){e[n]=t[n]})),void 0!==t.children&&this.seqencingData(t.children),this.treeArr.push(e)},getDataLists:function(){var e=this;this.groupId=t.getStorageSync("group_id"),this.$req({method:"GET",url:"/bank/app/playlists",data:{group_id:this.groupId}}).then((function(n){t.stopPullDownRefresh(),t.hideLoading(),e.array=n.data.message})).catch((function(t){console.log(t)}))},onClickTags:function(t){this.tags=t},createPlay:function(){this.id=0,t.hideTabBar(),this.$refs.drawer.open(),this.$refs.tkitree._reTreeList()},getContentList:function(){var e=this;this.getContentLists({page:this.page,pagesize:this.pagesize}).then((function(t){t.data.message.data?t.data.message.data.length<e.pagesize?(e.isLoadMore=!0,e.loadTitle="没有更多了...",setTimeout((function(){e.loadTitle=""}),3e3)):e.isLoadMore=!1:e.isLoadMore=!0})).catch((function(n){t.showToast({title:n,icon:"none"}),e.isLoadMore=!1,e.page>1&&e.PUT_CONTENT_PAGE(3)}))},toggleDirection:function(t){this.chooseAfterValue=[],this.direction=t},onHideDrawer:function(){var t=this.getDate({format:!0});this.playStatus=0,this.tree=[],this.formData.name="",this.chooseAfterValue=[],this.defaultActive=[],this.timeOther="请选择时间",this.endDate="请选择日期",this.dateStart=t,this.dateEnd=t},bindTimeChange:function(t,e){"0"===e?this.timeStart=t.target.value:(this.timeEnd=t.target.value,this.timeOther=this.timeEnd,this.setData({timeOther:this.timeEnd}))},bindDateChange:function(t,e){"0"===e?this.dateStart=t.target.value:(this.dateEnd=t.target.value,this.endDate=this.dateEnd)},formSubmit:function(e){var n=this,a=this._setSvaeDate();i.default.savePlayList(a).then((function(e){e.data.success?(t.showToast({title:"保存成功",duration:1200}),n.getDataLists(),n.$refs.drawer.hide(),n.onHideDrawer()):t.showToast({title:e.data.message,duration:1200})}))},confirmData:function(t){this.tree=t},_setSvaeDate:function(){var t=this.formData;return t.id=this.id,t.contents=this.chooseAfterValue,t.trees=this.tree,t.tags=this.tags,t.direction=this.direction,t.publish=0,t.schedule.time.start=this.timeStart,t.schedule.time.end=this.timeEnd,t.schedule.date.start=this.dateStart,t.schedule.date.end=this.dateEnd,t},operate:function(e,n){t.hideTabBar(),this.id=e.id,this.selectData=e,this.index=n,this.isOpened=!0},saveStu:function(){var t=!1;return t},previous:function(){this.playStatus>0&&this.playStatus--},next:function(){this.playStatus<2&&this.playStatus++},onCancelClick:function(){this.isOpened=!1,setTimeout((function(){t.showTabBar()}),380)},onhandClick:function(e){var n=this,a=this;switch(e){case 0:i.default.publishPlayList(this.id).then((function(t){n.onCallback(t),n.array[n.index].status=3}));break;case 1:i.default.stopPlayList(this.id).then((function(t){n.onCallback(t),n.array[n.index].status=0}));break;case 2:t.showModal({title:"提示",content:"是否删除播出单",success:function(t){t.confirm?i.default.deletePlayList(a.id,a.groupId).then((function(t){t.data.success&&(a.array=a.array.filter((function(t){return t.id!==a.id}))),a.onCallback(t)})):t.cancel&&a.onCancelClick()}});break;case 3:this.isOpened=!1,this.$refs.drawer.open(),this.selectData.trees.forEach((function(t,e){n.defaultActive.push(t.id),n.tree.push(t.id)})),this.chooseAfterValue=this.selectData.contents,this.formData.name=this.selectData.name,this.timeStart=this.selectData.schedule.time.start,this.timeOther=this.selectData.schedule.time.end,this.dateStart=this.selectData.schedule.date.start,this.endDate=this.selectData.schedule.date.end;break}},onCallback:function(e){e.data.success?(this.isOpened=!1,t.showToast({title:e.data.message,duration:1e3})):(this.isOpened=!1,t.showToast({title:"请求失败",image:"/static/Fail.png",duration:1200})),t.showTabBar()},getDate:function(t){var e=new Date,n=e.getFullYear(),i=e.getMonth()+1,a=e.getDate();return"start"===t?n-=60:"end"===t&&(n+=2),i=i>9?i:"0"+i,a=a>9?a:"0"+a,"".concat(n,"-").concat(i,"-").concat(a)}})};e.default=m}).call(this,n("543d")["default"])},a794:function(t,e,n){"use strict";var i=n("be2a"),a=n.n(i);a.a},b77f:function(t,e,n){"use strict";n.r(e);var i=n("b9db"),a=n("fd9f");for(var s in a)"default"!==s&&function(t){n.d(e,t,(function(){return a[t]}))}(s);n("a794");var r,o=n("f0c5"),c=Object(o["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);e["default"]=c.exports},b9db:function(t,e,n){"use strict";var i;n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var a=function(){var t=this,e=t.$createElement,n=(t._self._c,t.__map(t.fiterFiles,(function(e,n){var i=t.__get_orig(e),a=t.chooseAfterValue.indexOf(e.id);return{$orig:i,g0:a}})));t.$mp.data=Object.assign({},{$root:{l0:n}})},s=[]},be2a:function(t,e,n){},f585:function(t,e,n){"use strict";(function(t){n("8a46");i(n("66fd"));var e=i(n("b77f"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},fd9f:function(t,e,n){"use strict";n.r(e);var i=n("9c72"),a=n.n(i);for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=a.a}},[["f585","common/runtime","common/vendor"]]]);